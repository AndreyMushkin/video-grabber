!function(e,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var n={exports:{}};t(n.exports,n),e.tagsInput=n.exports}}(this,function(e,t){"use strict";t.exports=n;var d=8,f=9,v=13,g=37,h=39,m=46,k=44,y=",",x="placeholder pattern spellcheck autocomplete autocapitalize autofocus accessKey accept lang minLength maxLength required".split(" ");function n(i){function s(e,t,n,i){var s=document.createElement(e);for(var a in t&&(s.className=t),n&&(s.textContent=n),i)s.setAttribute("data-"+a,i[a]);return s}function r(e,t){return!0===t?Array.prototype.slice.call(p.querySelectorAll(e)):p.querySelector(e)}function t(){return r(".tag",!0).map(function(e){return e.textContent}).concat(p.input.value||[]).join(y)}function l(){i.value=t();var e=document.createEvent("Event");e.initEvent("change",!1,!0),i.dispatchEvent(e)}function a(e){if(~e.indexOf(y)&&(e=e.split(y)),Array.isArray(e))return e.forEach(a);var t=e&&e.trim();if(!t)return!1;if(!i.getAttribute("duplicates")){var n=function(){var e=r('[data-tag="'+t+'"]');if(e)return e.classList.add("dupe"),setTimeout(function(){return e.classList.remove("dupe")},100),{v:!1}}();if("object"==typeof n)return n.v}p.insertBefore(s("span","tag",t,{tag:t}),p.input)}function c(e){var t=r(".selected");t&&t.classList.remove("selected"),e&&e.classList.add("selected")}function o(){var e=r(".tag",!0).pop(),t=p.offsetWidth;p.firstChild!==p.input?p.input.placeholder="":p.input.placeholder=i.placeholder,t&&(p.input.style.width=Math.max(t-(e?e.offsetLeft+e.offsetWidth:5)-5,t/4)+"px")}function u(e){"string"==typeof e||Array.isArray(e)||(e=p.input.value),!1!==a(e)&&(p.input.value="",l(),o())}function e(e){return e.target.classList.contains("tag")&&c(e.target),e.target===p.input?c():(p.input.focus(),e.preventDefault(),!1)}var p=s("div","tags-input"),n=i.nextSibling;i.parentNode[n?"insertBefore":"appendChild"](p,n),i.style.cssText="position:absolute;left:0;top:-99px;width:1px;height:1px;opacity:0.01;",i.tabIndex=-1,p.input=s("input"),p.input.setAttribute("type","text"),x.forEach(function(e){if(i[e]!==p.input[e]){p.input[e]=i[e];try{delete i[e]}catch(e){}}}),p.appendChild(p.input),i.addEventListener("focus",function(){p.input.focus()}),p.input.addEventListener("focus",function(){p.classList.add("focus"),c()}),document.addEventListener("click",function(e){e.target!==r(".tag_advice ul li")&&e.target!==p.input&&(p.classList.remove("focus"),c(),u(),hideAdviceBlock())}),p.input.addEventListener("keypress",function(e){var t=p.input,n=e.charCode;return o(),n!==k?c():t.value||n===k?(u(),e.preventDefault(),!1):void 0}),p.input.addEventListener("keydown",function(e){var t=p.input,n=e.keyCode||e.which,i=r(".tag.selected"),s=t.selectionStart===t.selectionEnd&&t.selectionStart,a=r(".tag",!0).pop();if(o(),n===v||n===f)u();else if(n===m&&i)i.nextSibling!==p.input&&c(i.nextSibling),p.removeChild(i),o(),l();else if(n===d)if(i)c(i.previousSibling),p.removeChild(i),o(),l();else{if(!a||0!==s)return;c(a)}else if(n===g)if(i)i.previousSibling&&c(i.previousSibling);else{if(0!==s)return;c(a)}else{if(n!==h)return c();if(!i)return;c(i.nextSibling)}return e.preventDefault(),!1}),p.input.addEventListener("input",function(){i.value=t();var e=document.createEvent("Event");e.initEvent("input",!1,!0),i.dispatchEvent(e)}),p.input.addEventListener("paste",function(){return setTimeout(u,0)}),p.addEventListener("mousedown",e),p.addEventListener("touchstart",e),p.setValue=function(e){r(".tag",!0).forEach(function(e){return p.removeChild(e)}),u(e)},p.getValue=t,u(i.value)}n.enhance=n.tagsInput=n});var MAX_ADVICE_LENGTH=5;function onSkillType(){var e=$("#skills_block .tags-input input[type='text']"),t=$("#skills_block .tag_advice ul"),n=e.position(),i=e.val().match(/^\s*(.*)\s*$/)[1];querySearchData("search/skills",i,processSkills),t.css({top:n.top+e.height(),left:n.left})}function hideAdviceBlock(){setTimeout(function(){$("#interests_block .tag_advice ul").hide(),$("#skills_block .tag_advice ul").hide()},150)}function onInterestType(){var e=$("#interests_block .tags-input input[type='text']"),t=$("#interests_block .tag_advice ul"),n=e.position(),i=e.val().match(/^\s*(.*)\s*$/)[1];querySearchData("search/interests",i,processInterests),t.css({top:n.top+e.height(),left:n.left})}function processSkills(e){var t=$("#skills_block .tag_advice ul");if(e.skills.length){t.empty();var n=e.skills,i=0;for(var s in n)if(i<MAX_ADVICE_LENGTH){var a=$("#skills_block input[type='tags']"),r=$("#skills_block .tags-input input[type='text']"),l=new RegExp("(^|,)\\s*"+escapeRegSymb(n[s].name)+"\\s*(,\\s*.*\\s*)+($|,)");""===r.val().replace("/\\s*/g","")&&(l=new RegExp("(^|,)\\s*"+escapeRegSymb(n[s].name)+"\\s*($|,)")),a.val().match(l)||($("<li>",{append:$("<a>",{text:n[s].name+" ("+n[s].count+")"})}).click(onTagClick).appendTo("#skills_block .tag_advice ul"),i++)}t.children().length?t.show():t.hide()}else t.hide()}function processInterests(e){var t=$("#interests_block .tag_advice ul");if(e.interests.length){t.empty();var n=e.interests,i=0;for(var s in n)if(i<MAX_ADVICE_LENGTH){var a=$("#interests_block input[type='tags']"),r=$("#interests_block .tags-input input[type='text']"),l=new RegExp("(^|,)\\s*"+escapeRegSymb(n[s].name)+"\\s*(,\\s*.*\\s*)+($|,)");""===r.val().replace("/\\s*/g","")&&(l=new RegExp("(^|,)\\s*"+escapeRegSymb(n[s].name)+"\\s*($|,)")),a.val().match(l)||($("<li>",{append:$("<a>",{html:n[s].name+" ("+n[s].count+")"})}).click(onTagClick).appendTo("#interests_block .tag_advice ul"),i++)}t.children().length?t.show():t.hide()}else t.hide()}function onTagClick(e){var t=$(e.target).find("a"),n=deleteTags(t.text().replace(/\(\d+\)/,", ")),i=t.parents(".tag_edit_block").find("input[type='text']"),s=i.val().replace(/([^,;\n\s]+(?:[^,;\n][^,;\n])*)*$/,n+" ");i.val(s),i.focus()}function deleteTags(e){return e=e.replace(/<.*?>/g,"")}